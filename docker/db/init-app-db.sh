#!/bin/bash

# This line just tells the shell to stop if any error.
set -e

psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-EOSQL
	CREATE DATABASE $POSTGRES_TEST_DB;
	CREATE DATABASE $POSTGRES_DEV_DB;
	CREATE USER $POSTGRES_APP_USER WITH PASSWORD '$POSTGRES_APP_PASSWORD';
  GRANT ALL PRIVILEGES ON DATABASE $POSTGRES_TEST_DB TO $POSTGRES_APP_USER;
  GRANT ALL PRIVILEGES ON DATABASE $POSTGRES_DEV_DB TO $POSTGRES_APP_USER;
EOSQL
psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_TEST_DB" <<-EOSQL
	GRANT ALL ON SCHEMA public TO $POSTGRES_APP_USER;
EOSQL
psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DEV_DB" <<-EOSQL
	GRANT ALL ON SCHEMA public TO $POSTGRES_APP_USER;
EOSQL
