openapi: 3.0.0
info:
  description: Add syncables to the Moneybird API.
actions:
- target: paths['/administrations{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: administrations
      paginationStrategy: none
      query:
        format: .json

- target: paths['/{administration_id}/assets{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: assets
      paginationStrategy: pageNumber
      query:
        format: .json
      params:
        administration_id: administrations.id

- target: paths['/{administration_id}/contacts{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: contacts
      paginationStrategy: pageNumber
      synchronization: /{administration_id}/contacts/synchronization{format}
      query:
        format: .json
      params:
        administration_id: administrations.id

- target: paths['/{administration_id}/document_styles{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: document_styles
      paginationStrategy: none
      query:
        format: .json
      params:
        administration_id: administrations.id

- target: paths['/{administration_id}/documents/general_documents{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: general_documents
      paginationStrategy: pageNumber
      synchronization: /{administration_id}/documents/general_documents/synchronization{format}
      query:
        format: .json
      params:
        administration_id: administrations.id

- target: paths['/{administration_id}/documents/general_journal_documents{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: general_journal_documents
      paginationStrategy: pageNumber
      synchronization: /{administration_id}/documents/general_journal_documents/synchronization{format}
      query:
        format: .json
      params:
        administration_id: administrations.id

- target: paths['/{administration_id}/documents/purchase_invoices{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: purchase_invoices
      paginationStrategy: pageNumber
      synchronization: /{administration_id}/documents/purchase_invoices/synchronization{format}
      query:
        format: .json
      params:
        administration_id: administrations.id

- target: paths['/{administration_id}/documents/receipts{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: receipts
      paginationStrategy: pageNumber
      synchronization: /{administration_id}/documents/receipts/synchronization{format}
      query:
        format: .json
      params:
        administration_id: administrations.id

- target: paths['/{administration_id}/documents/typeless_documents{format}']['get']['responses']['200']['content']['application/json']
  update:
    syncable:
      name: typeless_documents
      paginationStrategy: pageNumber
      synchronization: /{administration_id}/documents/typeless_documents/synchronization{format}
      query:
        format: .json
      params:
        administration_id: administrations.id

# The Moneybird spec says identifiers can be strings or integers. What it really means is that
# it is a stringified integer. We don't have support for that (yet) so overriding it here to just string.
- target: components.schemas.identifier
  update:
    type: string
    commment: Moneybird identifiers are stringified integers, so we can just treat them as strings.

# This should be covered by the previous edit, but our code can't deal with $ref inside allOf,
# so need to do it manually here for now. We can add support for $ref inside allOf later, but this is faster to implement for now.:
- target: components.schemas
  update:
    administration_id:
      type: string
- target: components.schemas.administration_id.allOf
  remove: true

# /{administration_id}/downloads{format}
# /{administration_id}/estimates{format} [synchronization]
# /{administration_id}/external_sales_invoices{format}
# /{administration_id}/external_sales_invoices/{external_sales_invoice_id}/attachments/{id}/download{format}
# /{administration_id}/financial_accounts{format}
# /{administration_id}/financial_mutations{format} [synchronization]
# /{administration_id}/financial_statements{format}
# /{administration_id}/identities{format} + /{administration_id}/identities/default{format}
# /{administration_id}/ledger_accounts{format}
# /{administration_id}/products{format}
# /{administration_id}/projects{format}
# /{administration_id}/purchase_transactions{format}
# /{administration_id}/recurring_sales_invoices{format} [synchronization]
# ...